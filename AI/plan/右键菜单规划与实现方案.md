# 右键菜单规划与实现方案（草案）

本文档聚焦 Finder 扩展多菜单场景的功能规划、配置模型、UI 布局与开发顺序。目标：
- 支持不同菜单来源（空白区域 / items / 工具栏 / 侧边栏）
- 每个功能可配置启用与内容
- 配置页层次清晰、不凌乱、上手快

---

## 1. 菜单场景定义

### A. `.contextualMenuForContainer`（空白区域）
**建议功能**
1. 新建文件（已有，二级列表）
2. 常用目录（Fav Folders，二级列表）
3. 常用 App（Open With，二级列表）
4. 进入终端（进入当前目录）
5. 复制路径（复制当前目录路径）

### B. `.contextualMenuForItems`（选中文件/文件夹）
**建议功能**
1. 复制当前路径（已实现，复制选中项路径）
2. 移动到（Move To，二级列表：常用目录）

### C. `.toolbarItemMenu`（工具栏图标）
**建议功能（用于全局）**
1. 打开主程序
2. 打开授权目录管理
3. 打开常用目录（直接列表）
4. 快捷操作：进入终端（当前 Finder 目录）
5. 最近操作（可选）

### D. `.contextualMenuForSidebar`（侧边栏右键）
**建议功能**
1. 复制路径（侧边栏项路径）
2. 进入终端（侧边栏项目录）
3. 添加到常用目录（将该路径加入）

---

## 2. 配置模型建议（持久化）

### 2.1 基础配置结构
**MenuConfig**
- `container`: ContainerMenuConfig
- `items`: ItemsMenuConfig
- `toolbar`: ToolbarMenuConfig
- `sidebar`: SidebarMenuConfig

**通用字段**
- `enabled`: Bool
- `order`: Int
- `children`: [子项]

### 2.2 功能项结构
- `NewFile`（子项=模板列表）
- `FavoriteFolders`（子项=常用目录列表）
- `FavoriteApps`（子项=常用 App 列表）
- `CopyPath`
- `OpenTerminal`
- `MoveTo`（子项=常用目录列表）
- `AddToFavorites`

---

## 3. UI 布局方案（用户不凌乱）

### 3.1 左侧导航（一级）
1. 模板
2. 常用目录
3. 常用 App
4. 菜单配置（重点）
5. 授权目录
6. 日志
7. 设置

### 3.2 菜单配置页（重点设计）
**建议结构：四卡片 + 右侧详情**

- 左侧：四个 Tab/Segmented Control（空白区域 / 项目 / 工具栏 / 侧栏）
- 右侧：
  - 每个区域用卡片列表显示功能模块（拖拽排序）
  - 每个模块包含：
    - 开关（启用/禁用）
    - 内容入口（如常用目录/常用 App 的编辑入口）
    - 描述（会出现在菜单中哪里）

**防凌乱策略**
- 默认只显示常用功能，折叠高级功能
- 常用目录 / 常用 App 的编辑在独立页，菜单配置页只入口
- 统一模块样式（名称 + 开关 + 描述 + 右侧“配置”按钮）

---

## 4. 功能实现方案

### 4.1 Finder 扩展层
- 只负责：生成菜单、收集路径、发送消息
- 不写文件，不直接读取配置（由主程序下发）

### 4.2 主程序层
- 管理所有配置
- 通过 DistributedNotificationCenter 下发给扩展
- 执行“创建文件”“移动文件”等高权限行为

---

## 5. 开发顺序（建议）

### 第一阶段（基础可用）
1. 菜单配置模型 + 主程序 UI
2. 空白区域（container）功能：
   - 新建文件
   - 复制当前目录路径
   - 进入终端
3. Items 功能：
   - 复制选中项路径

### 第二阶段（常用目录/App）
1. 常用目录管理 UI（增删）
2. 常用 App 管理 UI
3. 空白区域增加：常用目录 / 常用 App

### 第三阶段（Move To / Sidebar / Toolbar）
1. Move To（使用常用目录）
2. Toolbar 菜单功能
3. Sidebar 功能 + 添加到常用目录

---

## 6. 推荐 UI 细节

- 菜单配置页：
  - `List + Section` 结构
  - 每个功能显示“启用”开关
  - 常用目录 / 常用 App 提供“管理”按钮

- 常用目录管理页：
  - 左侧列表
  - 右侧详情

- 常用 App 管理页：
  - 从系统 App 列表选择

---

## 7. 交互注意事项

- items 与 container 菜单严格区分
- “进入终端”必须获取当前目录路径
- “复制路径”统一逻辑，避免多处重复
- 所有菜单内容由主程序下发，避免扩展读配置

---

## 8. 下一步建议

建议从 **菜单配置页 + container/items 基础功能** 开始，这部分最能提升体验且不复杂。

如你确认方案，我可以：
1. 先实现「菜单配置页」+ 数据模型
2. 先落地 container/items 的最小菜单集
3. 再拓展常用目录/常用 App/MoveTo

---

